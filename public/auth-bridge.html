<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Bridge</title>
</head>
<body>
    <script>
        // This page should be hosted on mailsfinder.com to handle cross-domain auth requests
        
        // Listen for authentication requests from app.mailsfinder.com
        window.addEventListener('message', function(event) {
            // Only respond to requests from app.mailsfinder.com
            if (event.origin !== 'https://app.mailsfinder.com' && event.origin !== 'http://localhost:5173') {
                return;
            }
            
            if (event.data && event.data.type === 'REQUEST_AUTH_DATA') {
                console.log('Received auth data request from:', event.origin);
                
                // Check if user is logged in (this would depend on your mailsfinder.com implementation)
                // You would need to implement this based on how authentication works on mailsfinder.com
                
                try {
                    // Example: Check for authentication cookies or localStorage
                    const authToken = localStorage.getItem('auth_token');
                    const userEmail = localStorage.getItem('user_email');
                    const userName = localStorage.getItem('user_name');
                    
                    if (authToken && userEmail) {
                        // Send authentication data back to app.mailsfinder.com
                        const authData = {
                            type: 'USER_AUTH',
                            user: {
                                email: userEmail,
                                name: userName || userEmail.split('@')[0],
                                id: localStorage.getItem('user_id') || 'temp_id'
                            },
                            tokens: {
                                access_token: authToken,
                                refresh_token: localStorage.getItem('refresh_token'),
                                expires_at: localStorage.getItem('token_expires_at')
                            }
                        };
                        
                        console.log('Sending auth data to:', event.origin);
                        event.source.postMessage(authData, event.origin);
                    } else {
                        // No authentication found
                        console.log('No authentication found, user needs to log in');
                        event.source.postMessage({
                            type: 'USER_AUTH',
                            user: null,
                            tokens: null
                        }, event.origin);
                    }
                } catch (error) {
                    console.error('Error checking authentication:', error);
                    event.source.postMessage({
                        type: 'USER_AUTH',
                        user: null,
                        tokens: null,
                        error: 'Authentication check failed'
                    }, event.origin);
                }
            }
        });
        
        // Also check for authentication on page load and notify any child frames
        window.addEventListener('load', function() {
            console.log('Auth bridge loaded on mailsfinder.com');
        });
    </script>
</body>
</html>